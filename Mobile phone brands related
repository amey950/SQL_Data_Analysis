USER_ID  | MOBILE_NAME
------------------------
101      |  APPLE
202      |  XIOMI
303      |  APPLE
458      | SAMSUNG
303       |  XIOMI
202       | LG
707       | null
808       | APPLE
808       | GIONEE
202       | APPLE

Q.1) LIST OUT DIFFERENT TYPES OF MOBILE BRANDS WE HAVE IN DATA BASE HERE.

WITH CTE AS ( SELECT * FROM BRANDS_TABLE WHERE MOBILE_NAME IS NOT NULL)
SELECT DISTINCT(MOBILE_NAME) FROM CTE ;


Q.2) FIND THE USERS WHO HAVE BOUGHT APPLE PHONE

SELECT USER_ID 
FROM MOBILE_BRANDS
WHERE 
MOBILE_NAME  = 'APPLE'  ;


Q.3) FIND OUT THE USER_ID WHO HAVE APPLE MOBILE ONLY.

WITH CTE AS (
SELECT * FROM MOBILE_BRANDS WHERE MOBILE_NAME = 'APPLE'),

CTE_2 AS (
SELECT USER_ID , COUNT(DISTINCT(MOBILE_NAME)) AS DISTINCT_MOBILE_COUNT
FROM MOBILE_BRANDS
WHERE MOBILE_NAME IS NOT NULL
HAVING DISTINCT_MOBILE_COUNT = 1
)

SELECT USER_ID FROM CTE_1
INTERSECT
SELECT ID FROM CTE_2 


Q.4) FIND OUT THE USERS WHO HAVE NOT BOUGHT XIOMI PHONES

SELECT USER_ID FROM MOBILE_BRANDS WHERE MOBILE_NAME <> 'XIOMI' or 
MOBILE_NAME IS NOT NULL                                      --- This condition is important as we do not want 

Q.5) FIND OUT THE USERS WHO HAVE BOUGHT 2 PHONE BUT NONE OF THE PHONE IS XIOMI

WITH CTE AS (
SELECT * 
FROM 
MOBILE_BRANDS WHERE MOBILE_NAME <> 'XIOMI'
),

CTE_2 AS (
SELECT USER_ID , COUNT(*) AS TOTAL_COUNT 
FROM MOBILE_BRANDS GROUP BY 1 
HAVING TOTAL_COUNT = 2
)

SELECT * FROM CTE WHERE USER_ID IN (SELECT USER_ID FROM CTE_2 )

ALITER

SELECT * FROM MOBILE_BRANDS
WHERE USER_ID IN
(
SELECT USER_ID FROM CTE
INTERSECT
SELECT USER_ID FROM CTE_2
)

Q.6) ASSUMING THAT GIVEN DATA IS ARRANGED IN INCREASING ORDER OF DATE , FIND THE USERS WHO BOUGHT MORE THAN 1 PHONE AND 
THEIR FIRST MOBILE WAS OF NON APPLE BUT LATER MOBILE COULD OR COULD NOT OF APPLE BRAND

WITH CTE AS (SELECT USER_ID , GROUP_CONCAT(MOBILE_NAME) AS ALL_MOBILES FROM MOBILE_BRANDS GROUP BY USER_ID),   /* this will group all brands like apple xiomi .. */
CTE_2 AS (SELECT USER_ID , COUNT(*)  AS TOTAL_COUNT FROM MOBILE_BRANDS GROUP BY 1 HAVING TOTAL_COUNT > 1)   /* users who have more than 1 phone */ 
CTE_3 as (SELECT * FROM CTE WHERE ALL_MOBILES NOT LIKE 'Apple%')  /* users who have not bought apple as their first mobile */ 

SELECT * FROM MOBILE_BRANDS WHERE USER_ID IN 
(
SELECT USER_ID FROM CTE_2
INTERSECT
SELECT USER_ID FROM CTE_3
) ;
