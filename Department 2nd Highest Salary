Q) FIND THE 2ND HIGHEST SALARY FROM EACH DEPARTMENT , IF THERE IS NOT 2ND HIGHEST SALARY FOR ANY DEPARTMENT RESULT SHOULD BE null FOR THAT DEPARTMENT

CREATE OR REPLACE TABLE MMM (NAME TEXT , SALARY NUMBER , DEPARTMENT TEXT);    /* CREATING TABLE */

INSERT INTO MMM VALUES                     /* INSERTING VALUES , NOTE THAT THERE IS ONLY ONE ENTRY FOR MARKETING DEPT */
('AMEY', 75000 , 'SALES'), 
('JITU', 48000,'SALES'),
('HITESH', 85000,'MARKETING'),
('KITES',98000,'ENGG'),
('JOHN',89000,'ENGG');


WITH CTE AS (                                                             /* FIRST CTE FOR ATTACHING DENSE RANK COLUMN */                   
SELECT *, 
DENSE_RANK() OVER(PARTITION BY DEPARTMENT ORDER BY SALARY DESC) AS DRNK
FROM MMM
),
CTEE AS (SELECT * FROM CTE WHERE DRNK = 2)                                 /* HAVING ANOTHER CTE WHERE THERE ARE ONLY RECORDS WITH DENSE_RANK = 2*/

SELECT DISTINCT(MMM.DEPARTMENT) ,(CTEE.SALARY) FROM                  /* USING LEFT JOIN OF 2ND CTE WITH MAIN TABLE, TO FETCH ALL DEPTS FROM MAIN TABLE */
MMM LEFT JOIN CTEE
ON MMM.DEPARTMENT  = CTEE.DEPARTMENT 
;
